/* Render a virtual page view in Joplin's previewer
 *
 * jvirtpage.css is a stylesheet that will enable any note within the Joplin
 * application to render as an aesthetically pleasing virtual page in the
 * Joplin markdown viewer (the previewer).
 * 
 * Install the "Import Local CSS" plugin. Then @import this stylesheet within
 * your note. Alternatively, configure "Import Local CSS" to enable this
 * stylesheet by default for all of your notes.
 *
 * For more detail, refer to the documentation:
 * https://github.com/taw00/joplin-tweaks/docs/jvirtpage.md
 *
 * Copyright (c) Todd Warner <t0dd@protonmail.com>
 * This work is licensed under Attribution 4.0 International. To view a copy
 * of this license, visit http://creativecommons.org/licenses/by/4.0/
 */

@layer jvirtpage {
    :root {
        /* CONSTANTS */
        --jvp-text-color: black;
        --jvp-paper-color: white;
        --jvp-desktop-color: hsl(0deg 0% 66%); /* darkgray */
        --jvp-paper-box-shadow: 0 0 var(--jvp-page-spacing) black;
        --jvp-1st-page-marker-color: var(--jvp-desktop-color);

        --jvp-dim-text-color: black;
        --jvp-dim-paper-color: hsl(0deg 0% 75%); /* silver */
        --jvp-dim-desktop-color: hsl(0deg 0% 41%); /* dimgray */
        --jvp-dim-1st-page-marker-color: var(--jvp-dim-desktop-color);

        --jvp-dark-text-color: hsl(0deg 0% 96%); /* whitesmoke; not white */
        --jvp-dark-paper-color: hsl(0deg 0% 12%); /* very dark gray */
        --jvp-dark-desktop-color: hsl(0deg 0% 20%); /* darker than dimgray */
        /*--jvp-dark-desktop-color: hsl(222deg 12% 16%);*/ /* a dark purple-blue */
        --jvp-dark-1st-page-marker-color: var(--jvp-dark-desktop-color);

        /* popular page dimensions */
        --jvp-page-widthUS:  8.5in;  --jvp-page-heightUS:   11in;  --jvp-page-marginUS:   1in;
        --jvp-page-widthUSh: 5.5in;  --jvp-page-heightUSh: 8.5in;  --jvp-page-marginUSh: .5in;
        --jvp-page-widthA4:  210mm;  --jvp-page-heightA4:  297mm;  --jvp-page-marginA4:   1in;
        --jvp-page-widthA5:  148mm;  --jvp-page-heightA5:  210mm;  --jvp-page-marginA5:  .5in;
        --jvp-page-widthA6:  105mm;  --jvp-page-heightA6:  148mm;  --jvp-page-marginA6: .25in;

        /* default for each is 1/2 the default margin widths */
        --jvp-indentUS:  calc(var(--jvp-page-marginUS)  * .5);
        --jvp-indentUSh: calc(var(--jvp-page-marginUSh) * .5);
        --jvp-indentA4:  calc(var(--jvp-page-marginA4)  * .5);
        --jvp-indentA5:  calc(var(--jvp-page-marginA5)  * .5);
        --jvp-indentA6:  calc(var(--jvp-page-marginA6)  * .5);

        /* the defaults for page dimensions and margin and indent */
        --jvp-page-width:   var(--jvp-page-widthUS);
        --jvp-page-height: var(--jvp-page-heightUS);
        --jvp-page-margin: var(--jvp-page-marginUS);
        --jvp-indent:      var(--jvp-page-indentUS);


        /* SWITCHES
         * Switches to change the default page dimensions, margins, indent and
         * theme.  Enabled by sticking this div somewhere in your document, for
         * example:
         *      <div id="jvp" class="A5 landscape dark"></div>               */
        &:has( div#jvp:is(.dark)) {
            --jvp-text-color:    var(--jvp-dark-text-color);
            --jvp-paper-color:   var(--jvp-dark-paper-color);
            --jvp-desktop-color: var(--jvp-dark-desktop-color);
            --jvp-1st-page-marker-color: var(--jvp-dark-1st-page-marker-color);
        }
        &:has( div#jvp:is(.dim)) {
            --jvp-text-color:    var(--jvp-dim-text-color);
            --jvp-paper-color:   var(--jvp-dim-paper-color);
            --jvp-desktop-color: var(--jvp-dim-desktop-color);
            --jvp-1st-page-marker-color: var(--jvp-dim-1st-page-marker-color);
        }

        &:has( div#jvp:is(.US,.us)) {
            /* the defaults for everything - already set; being pedantic */
            --jvp-page-width:   var(--jvp-page-widthUS);
            --jvp-page-height: var(--jvp-page-heightUS);
            --jvp-page-margin: var(--jvp-page-marginUS);
            --jvp-indent:      var(--jvp-page-indentUS);
        }
        &:has( div#jvp:is(.US,.us).landscape) {
            --jvp-page-width: var(--jvp-page-heightUS);
            --jvp-page-height: var(--jvp-page-widthUS);
        }
        &:has( div#jvp:is(.USh,.USH,.ush)) {
            --jvp-page-width:   var(--jvp-page-widthUSh);
            --jvp-page-height: var(--jvp-page-heightUSh);
            --jvp-page-margin: var(--jvp-page-marginUSh);
            --jvp-indent:      var(--jvp-page-indentUSh);
        }
        &:has( div#jvp:is(.USh,.USH,.ush).landscape) {
            --jvp-page-width: var(--jvp-page-heightUSh);
            --jvp-page-height: var(--jvp-page-widthUSh);
        }
        &:has( div#jvp:is(.A4,.a4)) {
            --jvp-page-width:   var(--jvp-page-widthA4);
            --jvp-page-height: var(--jvp-page-heightA4);
            --jvp-page-margin: var(--jvp-page-marginA4);
            --jvp-indent:      var(--jvp-page-indentA4);
        }
        &:has( div#jvp:is(.A4,.a4).landscape) {
            --jvp-page-width: var(--jvp-page-heightA4);
            --jvp-page-height: var(--jvp-page-widthA4);
        }
        &:has( div#jvp:is(.A5,.a5)) {
            --jvp-page-width:   var(--jvp-page-widthA5);
            --jvp-page-height: var(--jvp-page-heightA5);
            --jvp-page-margin: var(--jvp-page-marginA5);
            --jvp-indent:      var(--jvp-page-indentA5);
        }
        &:has( div#jvp:is(.A5,.a5).landscape) {
            --jvp-page-width: var(--jvp-page-heightA5);
            --jvp-page-height: var(--jvp-page-widthA5);
        }
        &:has( div#jvp:is(.A6,.a6)) {
            --jvp-page-width:   var(--jvp-page-widthA6);
            --jvp-page-height: var(--jvp-page-heightA6);
            --jvp-page-margin: var(--jvp-page-marginA6);
            --jvp-indent:      var(--jvp-page-indentA6);
        }
        &:has( div#jvp:is(.A6,.a6).landscape) {
            --jvp-page-width: var(--jvp-page-heightA6);
            --jvp-page-height: var(--jvp-page-widthA6);
        }
        &:has( div#jvp.no-1st-page-marker) {
            --jvp-1st-page-marker-color: transparent;
        }

        /* OTHER CONSTANTS - don't change these */
        --jvp-page-spacing: 20px;
    } /* end :root */
} /* end @layer jvirtpage */


@page jvp-page-dimensions {
    /* IMPORTANT NOTE: Joplin 3.4.12 and older disallow exporting to PDF with a
     * different page size than what you have set in the joplin settings. That
     * limitation is a bug that should be fixed in the next major release.
     * https://github.com/laurent22/joplin/issues/13096
     *
     * The workaround is to export to HTML, open that in a browser, then print
     * to file (PDF). In a few months, as of this writing (20250916), this will
     * no longer be an issue.
     */
    size: var(--jvp-page-width) var(--jvp-page-height);
    margin: var(--jvp-page-margin);
}


/* Uncomment this :has and its mirroring brace at the end of the file if you
 * want to require <div id="jvp"></div> to exist in a note before allowing any
 * of this formatting to function.
:has( div#jvp ) {
*/

@media screen {
    html { background-color: transparent; }
    body {
        /* a virtual paper look: <body> is the "desk" behind the paper */
        background-color: var(--jvp-desktop-color);
        padding: 0;
    }

    body#joplin-container-body {
        /* Remove the padding and bg that frames #rendered-md */
        & > #joplin-container-content {
            background-color: transparent;
            padding: 0;
        }
    }
    /* rendered to HTML view */ 
    body:not(#joplin-container-body) {
        & > div.exported-note {
            margin: 0;
            padding: 0;
            & > div.exported-note-title {
                display: none !important;
            }
        }
    }

    /* Joplin Cloud stuff
     * - Fade the navbar and footer. Still present, just not prominent.
     * - Remove the viewport cruft (title, last-updated, padding, etc.) */
    body.page-note {
        /* footer with copyright and T&Cs - fade to watermark */
        & > div.footer { opacity: .5; }
        & > main.main > div.container.main-container {
            /* branded navbar - fade to watermark */
            & > nav.navbar {
                opacity: .15;
                background-color: inherit;
            }
            & > div.note-main {
                /* viewport to 100% */
                margin: 0 auto;
                padding: 0;
                max-width: 100%;
                /* remove note title */
                /* remove "Last updated" line */
                & > h1.title,
                & > p.last-updated { display: none; }
            }
        }
    }

    #rendered-md {
        position: relative;
        box-shadow: var(--jvp-paper-box-shadow);
        box-sizing: border-box;
        margin: var(--jvp-page-spacing) auto; /* just sets the page off the top a bit */
        padding: var(--jvp-page-margin);
        color: var(--jvp-text-color);
        background-color: var(--jvp-paper-color);
        width: 100%;
        max-width: var(--jvp-page-width);
        min-height: var(--jvp-page-height);
    } /* end #rendered-md */

    /* add a 1st-page-marker to the rendering */
    #rendered-md::before {
        display: block;
        position: absolute;
        content: "";
        top: var(--jvp-page-height);
        left: 0;
        width: calc(var(--jvp-page-margin) / 2);
        border-block-end: var(--jvp-1st-page-marker-color) solid 2px;
        opacity: 0.5;
    }

} /* end @media screen */


@media print {
    /* the body color needs to be irrelevant (trans) */
    body {
        page: jvp-page-dimensions;
        /* Exported print: the body should be colorless for print */
        background-color: transparent;
        /* Exported print: Remove the padding & bg that frames #rendered-md */
        & > #joplin-container-content {
            background-color: transparent;
            padding: 0;
        }
    }

    /* remove Joplin-inserted title & padding */
    body > div.exported-note {
        margin: 0;
        padding: 0;
        & > div.exported-note-title {
            display: none;
        }
    }

    /* Joplin Cloud stuff
     * - We don't want anything but our document to be printed. */
    body.page-note {
        /* remove footer with copright and T&Cs */
        & > div.footer { display: none; }
        & > main.main > div.container.main-container {
            /* remove branded navbar */
            & > nav.navbar { display: none; }
            & > div.note-main {
                /* viewport to 100% */
                margin: 0 auto;
                padding: 0;
                max-width: 100%;
                /* remove note title */
                /* remove "Last updated" line */
                & > h1.title,
                & > p.last-updated { display: none; }
            }
        }
    }

    div#joplin-container-pluginAssetsContainer { display: none !important; }


    html,
    body {
        width: 100%; max-width: 100%; border: 0; padding: 0; margin: 0; background-color: transparent;
    }
    #rendered-md {
        width: 100%; max-width: 100%; padding: 0; margin: 0; box-shadow: unset;
    }
}

/* Uncomment this brace and its mirroring :has toward the top of the file if
 * you want to require <div id="jvp"></div> to exist in a note before allowing
 * any of this formatting to function.
}
*/

